pkgname=linux-base
pkgver=1.0
pkgrel=1
pkgdesc='Arch linux base for binary compaitability.'
url='http://www.archlinux.org/'
license=('GPL')
arch=('any')
install=linuxbase.install
options=(!strip)
source=(http://arm.konnichi.com/2009/12/01/core/os/i686/bash-4.0.035-1-i686.pkg.tar.gz 
	http://arm.konnichi.com/2009/12/01/core/os/i686/bzip2-1.0.5-5-i686.pkg.tar.gz
	http://arm.konnichi.com/2009/12/01/core/os/i686/coreutils-7.6-1-i686.pkg.tar.gz
	http://arm.konnichi.com/2009/12/01/core/os/i686/db-4.8.24-1-i686.pkg.tar.gz
	http://arm.konnichi.com/2009/12/01/core/os/i686/e2fsprogs-1.41.9-1-i686.pkg.tar.gz
	http://arm.konnichi.com/2009/12/01/core/os/i686/filesystem-2009.07-1-i686.pkg.tar.gz	
	http://arm.konnichi.com/2009/12/01/core/os/i686/gdbm-1.8.3-6-i686.pkg.tar.gz
	http://arm.konnichi.com/2009/12/01/core/os/i686/glibc-2.11-1-i686.pkg.tar.gz
	http://arm.konnichi.com/2009/12/01/core/os/i686/glib2-2.22.2-1-i686.pkg.tar.gz
	http://arm.konnichi.com/2009/12/01/core/os/i686/grep-2.5.4-3-i686.pkg.tar.gz
	http://arm.konnichi.com/2009/12/01/core/os/i686/texinfo-4.13a-3-i686.pkg.tar.gz
	http://arm.konnichi.com/2009/12/01/core/os/i686/acl-2.2.48-1-i686.pkg.tar.gz		
	http://arm.konnichi.com/2009/12/01/core/os/i686/attr-2.4.44-1-i686.pkg.tar.gz
        http://arm.konnichi.com/2009/12/01/core/os/i686/libcap-2.17-1-i686.pkg.tar.gz
        http://arm.konnichi.com/2009/12/01/core/os/i686/gcc-libs-4.4.2-3-i686.pkg.tar.gz
	http://arm.konnichi.com/2009/12/01/core/os/i686/ncurses-5.7-2-i686.pkg.tar.gz
	http://arm.konnichi.com/2009/12/01/core/os/i686/pcre-8.00-1-i686.pkg.tar.gz
	http://arm.konnichi.com/2009/12/01/core/os/i686/popt-1.15-1-i686.pkg.tar.gz
	http://arm.konnichi.com/2009/12/01/core/os/i686/readline-6.0.004-1-i686.pkg.tar.gz
	http://arm.konnichi.com/2009/12/01/core/os/i686/zlib-1.2.3.3-3-i686.pkg.tar.gz
	http://arm.konnichi.com/2009/12/01/core/os/i686/pacman-3.3.3-1-i686.pkg.tar.gz
	http://arm.konnichi.com/2009/12/01/core/os/i686/pacman-mirrorlist-20090616-1-i686.pkg.tar.gz
	http://arm.konnichi.com/2009/12/01/core/os/i686/libarchive-2.7.1-1-i686.pkg.tar.gz
	http://arm.konnichi.com/2009/12/01/core/os/i686/libfetch-2.26-1-i686.pkg.tar.gz
	http://arm.konnichi.com/2009/12/01/core/os/i686/libgcrypt-1.4.4-2-i686.pkg.tar.gz
	yp.conf)
provides=('linux')

md5sums=('c7ebfae88411d303bf3fab08667f0db0'
         'add4a37ffac56244b2eb1da32e301d3c'
         '00c3f11549f6e94e8ade9e03c5bcd7fb'
         'a32040a2d4fec94764cc962a9c327792'
         'a13c4d9f4cbce7212c78484cf4ace4e1'
         '627762020d6043561eb066e4edbb111c'
         'a638e353570548eeec7da44a8da35078'
         '1c2b738dd40e86b224e0c0e1f0e7a1cd'
         '5860524514925bbe56ff124995c076f0'
         '0c28914fe078b2e52466f4a35acc0084'
         '332ef9d56d82a4686588a1184e915fe8'
         'f9b8b320f2f6f57339e706c65b8cf5a8'
         'ff9c97d1d23baffdc1413876bce9eade'
         'ba2aa43e64d59719b6eae0340f75c10f'
         '97078019bfcd2c2d6eee026ea25ac763'
         'c4740e92ae4946d2dd4febb6ee686321'
         'f60cf2d208573ed59654f1516fd4487c'
         'f12d083ae7c19fc3b99ac67305df57ec'
         '307fb2d34f753467e10c4aee62419cab'
         'fac386c898c0c84772598dd1ac1fc3b5'
         'f623aa7608373948a59dfeb7c23ead12'
         'e11d4185f8a45dd6380716428bd8f9ed'
         '9daa87c9417acb61d6c9ed8312d28ec3'
         '577bd5fa656869f4bc1718af462a4034'
         '0b7936c9b91528a7960cf1adf5039135'
         '794378866aad7e90d877469f3281d5af')

build() {

    #Remove the package files from src
    rm -f "${srcdir}"/*.{xz,gz}

    #Remove uneeded directories
    for d in boot dev etc/fonts home \
	     initrd media root tmp \
	     var/log var/run var/tmp \
	     usr/local usr/tmp; do
    rm -rf "${srcdir}/${d}"
    done
  
    #Remove uneeded files
    for f in bin/df bin/su etc/exports \
	     etc/group etc/localtime \
             etc/motd etc/passwd \
	     etc/printcap etc/services \
	     etc/protocols; do
    rm -f "${srcdir}/${f}"
    done

    #Add some directories
    for a in usr/X11R6/share usr/X11R6/man \
	     usr/X11R6/lib/tls \
	     usr/X11R6/include usr/X11R6/bin; do
    mkdir -p "${srcdir}/${a}"
    done

    # Create a good ld.so.conf and touch ld.so.cache
    echo -e '/lib\n/usr/lib\n/usr/X11R6/lib' >> "${srcdir}"/etc/ld.so.conf
    touch "${srcdir}"/etc/ld.so.cache

    install -m644 "${srcdir}"/yp.conf "${srcdir}"/etc
    touch "${srcdir}"/etc/mtab
    rm -f "${srcdir}"/yp.conf

    chmod u+w ${srcdir}/usr/bin/db*

    find ${srcdir}/bin ${srcdir}/sbin/ ${srcdir}/usr/bin \
		${srcdir}/usr/sbin -type f -print0 | xargs -0 file \
		| grep ELF | cut -d : -f 1 \
		| xargs brandelf -t Linux

}

package() {
	install -dm755 "${pkgdir}"/compat/linux
	cp -Ra "${srcdir}"/* "${pkgdir}"/compat/linux
}
