pkgname=gnome-doc-utils
pkgver=0.20.10
pkgrel=1
pkgdesc="Documentation utilities for Gnome"
arch=('any')
license=('GPL' 'LGPL')
depends=('libxslt' 'python2' 'docbook-xml' 'rarian')
makedepends=('intltool')
url="http://www.gnome.org"
source=(http://ftp.gnome.org/pub/gnome/sources/$pkgname/${pkgver%.*}/$pkgname-$pkgver.tar.xz)
sha256sums=('cb0639ffa9550b6ddf3b62f3b1add92fb92ab4690d351f2353cffe668be8c4a6')

build() {
  cd "$pkgname-$pkgver"

  unset CONFIG_SITE

  find "$srcdir/$pkgname-$pkgver" -name "Makefle.in*" -type f | xargs sed -i '' -e \
                                's|[(]libdir[)]/locale|(prefix)/share/locale|g ; \
                                 s|[(]libdir[)]/pkgconfig|(prefix)/libdata/pkgconfig|g ; \
                                 s|{libdir}/pkgconfig|(prefix)/libdata/pkgconfig|g ; \
                                 s|[(]datadir[)]/pkgconfig|(prefix)/libdata/pkgconfig|g ; \
                                 s|[(]prefix[)]/lib/pkgconfig|(prefix)/libdata/pkgconfig|g ; \
                                 s|[$$][(]localstatedir[)]/scrollkeeper|${SCROLLKEEPER_DIR}|g ; \
                                 s|[(]libdir[)]/bonobo/servers|(prefix)/libdata/bonobo/servers|g' ; \
  find "$srcdir/$pkgname-$pkgver" -name "configure" -type f | xargs sed -i '' -e \
                                's|-lpthread|-pthread|g' \
				-e 's|DATADIRNAME=lib|DATADIRNAME=share|g'  \
				-e 's|{libdir}/locale|{prefix}/share/locale|g'
  find "$srcdir"/$pkgname-$pkgver  -name "intltool-merge.in" | xargs  sed -i '' \
                                -e  's|mkdir $$lang or|mkdir $$lang, 0777 or|'  \
                                -e  's|^push @INC, "/.*|push @INC, "/usr/local/share/intltool" |'  \
                                -e  's|/usr/bin/iconv|/usr/local/bin/iconv|g'  \
                                -e  's|unpack *[(]'"'"'U\*'"'"'|unpack ('"'"'C*'"'"'|'


  PYTHON=/usr/local/bin/python2 ./configure --prefix=/usr/local \
      --sysconfdir=/usr/local/etc --mandir=/usr/share/man \
      --localstatedir=/var --disable-scrollkeeper
  gmake
}

package() {
  cd "$pkgname-$pkgver"
  gmake DESTDIR="$pkgdir" install
  sed -i '' -e "s|\/bin\/bash|\/usr\/local\/bin\/bash|g" ${pkgdir}/usr/local/bin/gnome-doc-tool
}
