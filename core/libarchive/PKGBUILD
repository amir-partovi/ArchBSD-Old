# $Id: PKGBUILD 167058 2012-09-25 03:07:21Z allan $
# Maintainer: Dan McGee <dan@archlinux.org>
# Contributor: Wolfgang Bumiller <blub@speed.at>

pkgname=libarchive
pkgver=3.1.2
pkgrel=2
pkgdesc="library that can create and read several streaming archive formats"
arch=('i686' 'x86_64')
url="http://libarchive.googlecode.com/"
license=('BSD')
depends=('libiconv' 'pkgconf')
source=("http://www.libarchive.org/downloads/libarchive-${pkgver}.tar.gz"
        "0001-mtree-fix-line-filename-length-calculation.patch")
md5sums=('efad5a503f66329bb9d2f4308b5de98a'
         'c38f4bb6da0bd9d2fe3dba4c7fc0840c')

build() {
  cd "$srcdir/$pkgname-$pkgver"

  CFLAGS="${CFLAGS} -DHAVE_BSDXML_H=1"
  LDFLAGS="${LDFLAGS} -lbsdxml"

  patch -Np1 -i "$srcdir/0001-mtree-fix-line-filename-length-calculation.patch"
  
  ./configure --prefix=/usr \
              --sysconfdir=/etc \
              --mandir=/usr/share/man \
              --infodir=/usr/share/info \
              --with-openssl --without-nettle \
              --without-expat --without-xml2
  make
}

check() {
  cd "$srcdir/$pkgname-$pkgver"
  make check
}

package() {
  cd "$srcdir/$pkgname-$pkgver"
  make DESTDIR="$pkgdir" install

  install -d -m755 "$pkgdir"/usr/share/licenses/libarchive/COPYING
  install -m644 COPYING "$pkgdir"/usr/share/licenses/libarchive/COPYING

}
